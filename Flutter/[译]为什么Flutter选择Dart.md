这篇笔记是翻译，原文[Why Flutter Uses Dart](https://medium.com/hackernoon/why-flutter-uses-dart-dd635a054ebf)

许多语言学家认为，一个人说的自然语言会影响他们的思维方式。同样的概念是否也适用于计算机语言？对于同一个问题，使用不同类型的编程语言的程序员往往会想出截然不同的解决方案。这里有一个更极端的例子，计算机科学家们为了鼓励更多的结构化程序而去掉了GOTO声明（与小说《1984》中的极权主义领袖从自然语言中驱逐异端词以消除思想罪的说法不尽相同，但你会明白的）。

这与Flutter和Dart有什么关系？其实有很大的关系。早期的Flutter团队评估了十几种语言，并选择了Dart，因为它符合他们构建用户界面的方式。

为什么开发者喜欢Flutter？答案是Dart。正如下面这则推特所说：

>Jordy
>@Jordy_vD_
>@flutterio让我看了一下@dart，我很高兴地玩了一下。#Dart是一门很棒的语言，而#flutterio把它带到了移动设备上，让它更进一步。

以下整理了Dart的特性，这些特性共同构成了Flutter不可缺少的功能。

- Dart是AOT(预先编译)类型语言，可编译成快速、可预测的原生代码，这使得Flutter几乎所有的代码都可以用Dart编写。这不仅让Flutter变得快速，几乎所有东西（包括所有的widgets）都可以自定义。
- Dart还可以通过JIT(即时编译)，以实现快速的开发周期和改变游戏规则的工作流(包括Flutter流行的亚秒级、有状态的热重载)。
- Dart让你更容易创建以60fps运行的流畅动画和转场。Dart可以在没有锁的情况下进行对象分配和垃圾回收。和JavaScript一样，Dart避免了抢先调度和共享内存（从而避免了锁）。因为Flutter应用程序被编译成了原生代码，所以它们不需要在层级领域之间建立缓慢的桥梁（例如，从JavaScript到原生）。它们的启动速度也更快。
- Dart允许Flutter避免了单独的声明式布局语言，如JX或XML，或单独的可视化界面构建器，因为Dart的声明式、程序化布局很容易阅读和可视化。而且，由于所有的布局都在一种语言和一个地方，Flutter很容易提供高级工具，使布局变得简单易行。
- 开发人员发现，Dart特别容易学习，因为它具有静态和动态语言用户都熟悉的功能。

并非所有这些功能都是Dart独有的，但它们的结合让Dart在实现Flutter方面具有独特的优势。以至于很难想象没有Dart，Flutter会有如此强大的功能。

![Flutter loves Dart](https://miro.medium.com/max/1326/1*bAUFoOPQ3gcv7y4Kdz82tw.png)

本文的其余部分将更深入地介绍Dart的许多特点（包括其标准库），使其成为*实现Flutter的最佳语言*。

## 编译和执行

*[如果你已经了解静态语言与动态语言、AOT和JIT编译以及虚拟机等主题，你可以跳过这一部分。]*

历史上，计算机语言被分为两类：静态语言（如Fortran或C语言，在编译时，变量在编译时被静态地键入）和动态语言（如Smalltalk或JavaScript，在运行时，变量的类型可以改变）。静态语言通常被编译成目标机器的原生机器码（或汇编代码）程序，在运行时由硬件直接执行。动态语言由解释器执行，不产生机器码。

当然，事情最终变得更加复杂了。虚拟机(VM)的概念开始流行，它实际上只是一个高级解释器，在软件上模仿硬件机器的高级解释器。虚拟机使得将一种语言移植到新的硬件平台上更容易。在这种情况下，虚拟机的输入语言往往是一种中间语言。例如，将一种编程语言（如Java）编译成中间语言（字节码），然后在虚拟机（JVM）上执行。

此外，现在还有即时编译器（JIT）。JIT编译器是在程序执行过程中运行，即时编译。原来在程序创建过程中（运行前）执行的编译器现在被称为预先编译器（AOT）。

一般来说，只有静态语言才适合AOT编译成原生机器码，因为机器语言通常需要知道数据的类型，而在动态语言中，类型是不固定的。因此，动态语言通常被解释或JIT编译。

当AOT编译是在开发过程中进行的，它必然会导致开发周期变慢（从对程序进行修改到能够执行程序以查看修改结果之间的时间）。但AOT编译的结果是，程序在运行时可以更可预测地执行，而且不需要暂停分析和编译。AOT编译后的程序的启动速度也更快（因为它们已经被编译过了）。

相反，JIT编译器提供了更快的开发周期，但会导致程序执行速度更慢或更笨拙。特别是，JIT编译器的启动时间更慢，因为当程序启动时，JIT编译器必须先进行分析和编译，然后才能执行代码。研究表明，如果一个程序的启动时间超过几秒钟，就会被人们放弃。

开胃菜已经上完了，如果能将AOT和JIT编译的优点结合在一起，啧啧啧，岂不是无敌？请继续看。

## 编译和执行Dart

在开发Dart之前，Dart团队的成员们已经在高级编译器和虚拟机方面做了一些开创性的工作，包括动态语言（如JavaScript的V8引擎和Smalltalk的Strongtalk）和静态语言（如Java的Hotspot编译器）。他们利用这些经验，使Dart在编译和执行方式上变得异常灵活。

适合同时被AOT和JIT编译的语言中，Dart是为数不多的语言之一（也许也是唯一的 "主流 "语言）。支持这两种编译方式为Dart和（特别是）Flutter提供了显著的优势。

在开发过程中使用JIT编译，编译速度会特别快。然后，当应用程序准备好发布时，再进行AOT编译。因此，在先进的工具和编译器的帮助下，Dart可以实现两个世界的最佳效果：极快的开发周期，以及快速的执行和启动时间。

Dart在编译和执行方面的灵活性并不止于此。例如，Dart可以被编译成JavaScript，这样它就可以被浏览器执行。这使得移动应用和Web应用之间的代码可以重用。开发者们说，他们的移动应用和Web应用之间的代码重用率高达70%。Dart也可以在服务器上使用，可以编译成原生代码，也可以编译成JavaScript并与node.js一起使用。

最后，Dart还提供了一个独立的虚拟机，它使用Dart语言本身作为中间语言（本质上就像一个解释器）。

Dart可以有效地编译AOT、JIT、作为解释器使用或移植到其他语言中。Dart的编译和执行不仅非常灵活，而且速度特别快。

接下来，我们将以Dart的编译速度为例，说明Dart的编译速度是如何改变游戏规则的.....

## Stateful热重载

Flutter最受欢迎的特点之一是其极快的热重载速度。在开发过程中，Flutter使用了一个JIT编译器，通常在一秒钟之内就能重新加载并继续执行代码。在可能的情况下，App的状态会被保留在整个重载过程中，这样App就可以从原来的地方继续执行。

![Flutter’s sub-second stateful hot reload](https://miro.medium.com/max/1400/1*c1dM9uhkRj9_fpiDrLJmDw.gif)

除非你亲自体验过，否则很难体会到开发过程中真正快速（可靠）的热重载是多么的重要。开发者们说，这改变了他们创建APP的方式——就像把他们的APP画成了生活。

以下是一位移动应用开发者对Flutter热重载的评价。

>我想测试一下热重载，于是换了个颜色，保存了我的修改，然后...........爱了爱了！
>这个功能真的是太神奇了。原本以为Visual Studio中的``Edit & Continue``功能已经很好，但这个简直让人震惊。有了这个特性，我觉得一个移动开发者的工作效率可以提高2倍。
>对我来说，这真的是改变了游戏规则。当我部署代码时，我的代码需要很长时间，我就会失去专注力，我会做其他事情，当我回到模拟器/设备时，我已经忘记了我想要测试的内容。还有什么比让我失去5分钟的时间来移动一个控件的2px像素更令人沮丧呢？有了Flutter之后，这种情况将不复存在。

Flutter热重载让我们更容易尝试新的想法或实验替代方案，为创造力提供了巨大的推动力。

到目前为止，我们已经讨论了Dart是如何让开发者更好地完成任务的。接下来的内容是关于Dart如何也能让用户更轻松地创造出流畅的App，让用户满意。



